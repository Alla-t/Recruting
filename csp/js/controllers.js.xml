<?xml version="1.0" encoding="UTF-8"?>
<Export generator="Cache" version="25">
<CSP name="js/controllers.js" application="/csp/vacancy/"><![CDATA[
'use strict';

function vacancyCtrl($scope, $http){

    // функция получения вакансий
    $scope.getVacancies=function(){
        $http.get("/v/json/vacancies").success(function(data){
            $scope.vacancies=data.children;}).error(function(data,status){
                $scope.alertzone="["+status+"] Ошибка загрузки компаний :( ["+data+"]"; });
    }


    // функция аутентификации - считываем данные из БД - возвращаем результат

    $scope.authVerify=function(){

        $http.get("/v/json/authVerify/"+$scope.authLogin+"/"+$scope.authPassword).success(function(data){
            try{
                // пробуем считать результат
				var fName = data.children[0]["FirstName"];
                $scope.name =fName;
                $scope.h=1;
               //authConstruct(fName);
            } catch(err){
                // если не удалось считать - значит ошибка входа
                alert("Неправильно введен логин/пароль. Повторите ввод","Ошибка аутентификации");
                $scope.authLogin = "";
                $scope.authPassword = "";
            }
        }).error(function(data,status){
                $scope.alertzone="["+status+"] Ошибка загрузки :( ["+data+"]"; });
    }

    // функция получения компаний с кол-вом вакансий
    $scope.getCompaniesVacancies=function(){
        $http.get("/v/json/comvac").success(function(data){
            $scope.comvac=data.children;
        }).error(function(data,status){
                $scope.alertzone="["+status+"] Ошибка загрузки компаний :( ["+data+"]"; });

    }

    $scope.getVacancies();
    $scope.getCompaniesVacancies();
}

function vacancyShowCtrl($scope,$http){
	   
	   // функция показа вакансии
       $scope.showVacancy = function(vacID){
	     $http.get("/v/json/vacancy/"+vacID).success(function(data){
			try	{
				// передаем массив полученных данных в функцию формирования текста
				// выведем результат в соотвествующие поля
				var vac = data.children
				$scope.txtVacancyName = vac[0]["VacancyName"]
				$scope.txtVacancyCompany = vac[0]["CompanyName"]
				$scope.txtVacancyCity = vac[0]["CityVacancy"]
				$scope.txtRegDate = vac[0]["RegDate"]
				$scope.txtEduLevel = vac[0]["EduLevel"]
				$scope.txtStartSalary = vac[0]["StartSalary"]
				$scope.txtEndSalary = vac[0]["EndSalary"]
				$scope.txtAddInfo = vac[0]["AddInfo"]
				$scope.txtMainInfo = vac[0]["MainInfo"]
                $scope.txtCompMainInfo = vac[0]["CompMainInfo"]
                $scope.txtLinks = vac[0]["Links_URL"]
                       
                // показываем слой с инфо о вакансии
                $scope.showV=true;
                // скрываем слой с формой ввода отклика
                $scope.showR=false;

			} catch(err){	
			}
			}).error(function(data,status){
			$scope.alertzone="["+status+"] Ошибка загрузки компаний :( ["+data+"]"; });
	   }
	   
	   // добавляем новый отзыв о вакансии
	   $scope.newResponse = function (compid, v){
		    $http.post("/v/json/vacancyresp/"+compid,v)
		    .success(function(data){
                    $scope.alertzone="FirstName:"+v.FirstName;}).error(function(data,status){
			$scope.alertzone="["+status+"] Ошибка добавления отзыва :( ["+data+"]"; });

		    }

      // функция показа/скрытия слоёв с инфо о вакансии и с формой ввода отзыва
       $scope.showResponseForm = function(sh){
           if(sh){
               $scope.showR = true;
               $scope.showV = false;
           } else {
               $scope.showV = true;
               $scope.showR = false;
           }

    }
    
           // картинка  
    	   $scope.newImage= function (compid, v){
		    $http.post("/v/json/vimage/"+compid,v)
		    .success(function(data){
                    $scope.alertzone="FirstName:"+v.FirstName;}).error(function(data,status){
			$scope.alertzone="["+status+"] Ошибка добавления  :( ["+data+"]"; });

		    }
		    
		    

		    		    
}

function SystemUserShow($scope,$http){

		    // получение всех пользователей
		    $scope.GetAllSystemUsers=function(){
       		$http.get("/v/json/getallusers/").success(function(data){
	       		
            $scope.allusers=data.children;}).error(function(data,status){
            $scope.alertzone="["+status+"] Ошибка загрузки пользователей :( ["+data+"]"; });
    		}
    		
		    // получение  пользователя
		    $scope.GetSystemUser=function(compid){
       		$http.get("/v/json/getuser/"+compid).success(function(data){
	       		
            $scope.user=data.children;}).error(function(data,status){
            $scope.alertzone="["+status+"] Ошибка загрузки пользователя :( ["+data+"]"; });
    		}
    		
    	   // добавляем нового пользователя
	   		$scope.newuser = function (v){
		    $http.put("/v/json/createuser/",v)
		    .success(function(data){
                    $scope.alertzone="FirstName:"+v.FirstName;}).error(function(data,status){
			$scope.alertzone="["+status+"] Ошибка добавления пользователя :( ["+data+"]"; });

		    }
		    
		     // Обновление пользователя
	   		$scope.updateuser = function (compid,v){
		    $http.post("/v/json/updateteuser/"+compid,v)
		    .success(function(data){
                    $scope.alertzone="FirstName:"+v.FirstName;}).error(function(data,status){
			$scope.alertzone="["+status+"] Ошибка добавления пользователя :( ["+data+"]"; });

		    }
		    
		    
		    // удаление пользователя
	    	$scope.deleteuser = function (compid){
		    $http.delete("/v/json/deleteuser/"+compid)
		    .success(function(data){
			    document.location.href = "/csp/vacancy/user.csp";
			    }).error(function(data,status){
			$scope.alertzone="["+status+"] Error delete user :( ["+data+"]"; });
		    }    
		    
    		
    $scope.GetAllSystemUsers();


}

]]></CSP>
</Export>
