<?xml version="1.0" encoding="UTF-8"?>
<Export generator="Cache" version="25">
<CSP name="Image.CSP" application="/csp/vacancy/"><![CDATA[

<script language="Cache" runat="Server">
set a=##class(Vacancy.Vacancy).%OpenId($Get(%request.Data("id",1),1))
set oid=a.Img.%Oid()












  #dim smtp As %Net.SMTP
  #dim mail As %Net.MailMessage
  
  set mail=##class(%Net.MailMessage).%New()
  set mail.From="18523897@mail.ru"
  set mail.Subject="Новый отзыв"
  set mail.Charset="utf-8"
  set mail.IsHTML=1
  set mail.ContentType="text/html"
  do mail.TextData.Write("Добавлен новый отзыв на вакансию")
  do mail.To.Insert("18523897@mail.ru")
  
 // Set auth=##class(%Net.Authenticator).%New()
 // Set auth.UserName="ermakov.victor.mihailovich@gmail.com"
 // Set auth.Password=""
  

  
  set smtp=##class(%Net.SMTP).%New()
  set smtp.smtpserver="smtp.mail.ru"
  set smtp.port=25
 set smtp.authenticator.Password=""
 set smtp.authenticator.UserName="18523897@mail.ru"
  // =""
  //set smtp.Login("18523897@mail.ru")
  //set smtp.
  s sc2= smtp.Send(mail)
  w sc2




 </script>
 
<image src="%25CSP.StreamServer.cls?STREAMOID=#(..Encrypt(oid))#">

<script language="Cache" runat="Server">
Set httpR=##class(Vacancy.VacancyView).%New()
s httpR.Browser=%session.BrowserName
s httpR.URL=%request.URL
s httpR.TimeStamp=$zdt($h,4)
s httpR.IP=%request.GatewayConnectionName
//w ##class(%SYSTEM.INetInfo).GetInterfacesInfo()
s httpR.Vacancy=$Get(%request.Data("id",1),1)
do httpR.%Save()
</script>
]]></CSP>
</Export>
