<?xml version="1.0" encoding="UTF-8"?>
<Export generator="Cache" version="25">
<CSP name="Image.CSP" application="/csp/vacancy/"><![CDATA[

<script language="Cache" runat="Server">
set a=##class(Vacancy.Vacancy).%OpenId($Get(%request.Data("id",1),1))
set oid=a.Img.%Oid()

 </script>
 
<image src="%25CSP.StreamServer.cls?STREAMOID=#(..Encrypt(oid))#">

<script language="Cache" runat="Server">
// Добавляем новую запись о просмотре вакансии
Set httpR=##class(Vacancy.VacancyView).%New()
set httpR.Browser=%session.BrowserName
set httpRr=##class(%Net.HttpRequest).%New()
set httpR.URL=httpRr.Referer


set httpR.TimeStamp=$zdt($h,4)
set httpR.IP=%request.GatewayConnectionName
//w ##class(%SYSTEM.INetInfo).GetInterfacesInfo()
set httpR.Vacancy=$Get(%request.Data("id",1),1)
do httpR.%Save()
</script>
]]></CSP>
</Export>
