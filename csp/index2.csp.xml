<?xml version="1.0" encoding="UTF-8"?>
<Export generator="Cache" version="25">
<CSP name="index2.CSP" application="/csp/vacancy/"><![CDATA[
<!doctype html>
<html ng-app>
<head>
	<title>Vacancy</title>
	<script language ="javascript"> 
	// здесь обработчики будут
function control ($scope,$http){
	// после переустановки каше порт стал 57773, а не 57772 как во всех примерах
	// получаем данные в формате json и засовываем их в $scope.companies
	// опять же абсолютная ссылка что бы не разбираться
		$scope.getVacancies=function(){
		// надо будет какую то универсальную относительную ссылку - у меня
		// только абсолютная работает
		$http.get("/v/json/vacancies").success(function(data){
			$scope.vacancies=data.children;}).error(function(data,status){
			$scope.alertzone="["+status+"] Ошибка загрузки компаний :( ["+data+"]"; });
			
		    }
	 ///тк теперь это функция - вызываем её, т.к. при изменениях в БД необходимо повторно обновлять используемый набор данных
		$scope.getCompanyByID=function(compid){
		$http.get("/v/json/company/"+compid).success(function(data){
			$scope.companies=data.children;}).error(function(data,status){
			$scope.alertzone="["+status+"] Ошибка загрузки компаний :( ["+data+"]"; });
			
		    }
		
		
		$scope.authVerify=function(){
	
			$http.get("/v/json/authVerify/"+$scope.authLogin+"/"+$scope.authPassword).success(function(data){
				try{ 
          			var fName = data.children[0]["FirstName"];
         		 	$scope.name =fName;
          			authConstruct(fName);
        		} catch(err){
          			alert("Неправильно введен логин/пароль. Повторите ввод","Ошибка аутентификации");
          			$scope.authLogin = "";
         			$scope.authPassword = "";
        		}
        }).error(function(data,status){
       $scope.alertzone="["+status+"] Ошибка загрузки :( ["+data+"]"; });
       }
     
       $scope.authLogout = function (){
      		document.getElementById("authOut").style.display='none';
      		document.getElementById("authIN").style.display='';
       }
       
       function authConstruct(fName){
     		document.getElementById("authIN").style.display='none';
      		document.getElementById("authOut").style.display='';
       }
       
       $scope.getVacancies();
       
       $scope.showVacancy = function(str){
	      alert(str);
	   }
		//$scope.getCompanyByID("1");
 }//control
	</script>
<link href="bootstrap/css/bootstrap.min.css" rel="stylesheet" type="text/css">
</head>
<style>
	.block1 {
			height:50px;
			background:magenta;
	       }
	
</style>

<body  ng-controller="control">
<h1 ng-model="alertzone" ng-hide="true"><font color=red>ИДЁТ ЗАГРУЗКА ДАННЫХ. Пожалуйста ПОДОЖДИТЕ</font></h1>

	<div class="container">
		<head>
			<img src="img/intersystems-header.gif">		
		</head>
		
		<div class="navbar">
		  <nav class="navbar-inner">	
			<a class="brand" href="#">&nbsp Вакансии</a>
			<ul class="nav">
				<li class="divider-vertical"></li>
				<li><a href="#"><i class="icon-envelope"></i>&nbsp Обратная связь</a></li>
				<li><a href="#"><i class="icon-thumbs-up"></i>&nbsp Наши партнеры</a></li>
			</ul>
			
			  <div>
				<form ng-submit="authVerify()" class="navbar-form pull-right" >
					<div ID="authIN">
            			<input ng-model="authLogin" type="text" class="span2" placeholder="логин" required>
            			<input ng-model="authPassword" type="password" class="span2" placeholder="пароль" required>
            			<button type="submit" class="btn" >Войти</button>
          			</div>
        		</form>  
        
        		<form ng-submit="authLogout()" class="navbar-form pull-right" >
          		  <div ID="authOut" style="display:none;" class="navbar-for pull-right" >
           			<div class = "span3">
              			<p class="text-info" style="margin:0px">Добрый день, {{name}}</br>
             			<i class="icon-user"></i>&nbsp
             			<small><a href="" >Личный кабинет</a></small></p>
            		</div>
            		<div class = "span1">   
             			 <button type="submit" class="btn" >Выйти</button>
            	    </div>
          		  </div>  
         		</form>  
         	 </div>
        
        </nav>   
     </div>
		
		<div class="row ">
		  <div class="input-append span5">
			<input type="text" size="100" id="appendedInput"  ng-model="filterVacancy" placeholder="Введите слово для поиска">
			<span class="add-on"><i class="icon-filter"></i></span>
		  </div>	 
		  <div class="span7"></div>			
		</div>

		<div>
	      <nav class='navbar-inner reverse'>
	        <ul class='nav nav-pills nav-stacked'>
	          <li ng-repeat="vacancy in vacancies | filter:filterVacancy">
 	            
	            	<a  ng-click="showVacancy({{vacancy.IDVac}});" class='text-info' href=''>
	              		<i class="icon-hand-right"></i>&nbsp&nbsp
	              		<input type="hidden" ng-model="vacID" value="{{vacancy.IDVac}}" />
	              	
	              		<b>{{vacancy.VacancyName}}</b>
	            	</a>
		
	            <small ><a href='' class="text-success">{{vacancy.CompanyName}}</a></small>
	            <small>, <a href=''>{{vacancy.Adress_City}}</a></small>
	            <small class="text-error">, {{vacancy.StartSalary}} до {{vacancy.EndSalary}} руб.</small>
	           
	            <font size='1px'>{{vacancy.RegDate}}</font>
	            <hr style='margin-bottom:0px;'>
	          </li>
	         </ul>
	       </nav>
	     </div>
	
		<div id="footer">
			<div class=""></div>
			
		</div>
		
		
	</div>

    <script src="bootstrap/js/bootstrap.min.js"></script>
    <script src="http://code.jquery/jquery-latest.js"></script>
    
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.0.7/angular.min.js"></script>
</body>
</html>
]]></CSP>
</Export>
