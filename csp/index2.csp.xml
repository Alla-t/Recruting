<?xml version="1.0" encoding="UTF-8"?>
<Export generator="Cache" version="25">
<CSP name="index2.CSP" application="/csp/vacancy/"><![CDATA[
<!doctype html>
<html ng-app>
<head>
	<title>Vacancy</title>
	<script language ="javascript"> 
	// здесь обработчики будут
function control ($scope,$http){
	// после переустановки каше порт стал 57773, а не 57772 как во всех примерах
	// получаем данные в формате json и засовываем их в $scope.companies
	// опять же абсолютная ссылка что бы не разбираться
		$scope.getVacancies=function(){
		// надо будет какую то универсальную относительную ссылку - у меня
		// только абсолютная работает
		$http.get("/v/json/vacancies").success(function(data){
			$scope.vacancies=data.children;}).error(function(data,status){
			$scope.alertzone="["+status+"] Ошибка загрузки компаний :( ["+data+"]"; });
			
		    }
	 ///тк теперь это функция - вызываем её, т.к. при изменениях в БД необходимо повторно обновлять используемый набор данных
		$scope.getCompanyByID=function(compid){
		$http.get("/v/json/company/"+compid).success(function(data){
			$scope.companies=data.children;}).error(function(data,status){
			$scope.alertzone="["+status+"] Ошибка загрузки компаний :( ["+data+"]"; });
			
		    }
		
		// функция аутентификации - считываем данные из БД - возвращаем результат
		$scope.authVerify=function(){
	
			$http.get("/v/json/authVerify/"+$scope.authLogin+"/"+$scope.authPassword).success(function(data){
				try{ 
          			// пробуем считать результат
          			var fName = data.children[0]["FirstName"];
         		 	$scope.name =fName;
          			authConstruct(fName);
        		} catch(err){
	        		// если не удалось считать - значит ошибка входа
          			alert("Неправильно введен логин/пароль. Повторите ввод","Ошибка аутентификации");
          			$scope.authLogin = "";
         			$scope.authPassword = "";
        		}
        }).error(function(data,status){
       $scope.alertzone="["+status+"] Ошибка загрузки :( ["+data+"]"; });
       }
     
       // функция скрытия формы входа
       $scope.authLogout = function (){
      		document.getElementById("authOut").style.display='none';
      		document.getElementById("authIN").style.display='';
       }
       
       // функия отображения слоя с персональной информацией
       function authConstruct(fName){
     		document.getElementById("authIN").style.display='none';
      		document.getElementById("authOut").style.display='';
       }
       
      // функция показа вакансии
       $scope.showVacancy = function(vacID){
	     $http.get("/v/json/vacancy/"+vacID).success(function(data){
			try	{
				// передаем массив полученных данных в функцию формирования текста
				// выведем результат в соотвествующие поля
				$scope.txtVacancyName = data.children[0]["VacancyName"]
				$scope.txtVacancyCompany = data.children[0]["CompanyName"]
				$scope.txtVacancyCity = data.children[0]["CityVacancy"]
				$scope.txtRegDate = data.children[0]["RegDate"]
				$scope.txtEduLevel = data.children[0]["EduLevel"]
				$scope.txtStartSalary = data.children[0]["StartSalary"]
				$scope.txtEndSalary = data.children[0]["EndSalary"]
				$scope.txtAddInfo = data.children[0]["AddInfo"]
				$scope.txtMainInfo = data.children[0]["MainInfo"]
				vacancyConstruct();
			} catch(err){	
			}
			}).error(function(data,status){
			$scope.alertzone="["+status+"] Ошибка загрузки компаний :( ["+data+"]"; });
			
	   }
	   
	   // функия отображения слоя с выбранной вакансией
       function vacancyConstruct(){
     		document.getElementById("vacancyShow").style.display='';
      		document.getElementById("vacanciesShow").style.display='none';
       }
	   
	   // функия отображения слоя со списком вакансий
       $scope.vacanciesConstruct = function (){
     		document.getElementById("vacancyShow").style.display='none';
      		document.getElementById("vacanciesShow").style.display='';
       }
	   
	   $scope.getVacancies();
		//$scope.getCompanyByID("1");
 }//control
  		
	</script>
<link href="bootstrap/css/bootstrap.min.css" rel="stylesheet" type="text/css">
</head>
<style>
	.block1 {
			height:50px;
			background:magenta;
	       }
	
</style>

<body  ng-controller="control">
<h1 ng-model="alertzone" ng-hide="true"><font color=red>ИДЁТ ЗАГРУЗКА ДАННЫХ. Пожалуйста ПОДОЖДИТЕ</font></h1>

	<div class="container">
		<head>
			<img src="img/intersystems-header.gif">		
		</head>
		
 <!---НАВИГАЦИОННАЯ ПАНЕЛЬ--->  	
		<div class="navbar" style="margin-bottom:10px;">
		  <nav class="navbar-inner">	
			<a class="brand" href="/csp/vacancy/index2.CSP">&nbsp Вакансии</a>
			<ul class="nav">
				<li class="divider-vertical"></li>
				<li><a href="#"><i class="icon-envelope"></i>&nbsp Обратная связь</a></li>
				<li><a href="#"><i class="icon-thumbs-up"></i>&nbsp Наши партнеры</a></li>
			</ul>
			
			
		<!---АУТЕНТИФИКАЦИЯ--->  	
			  <div>
			  
			  <!---АУТЕНТИФИКАЦИЯ_ФОРМА ВХОДА--->
				<form ng-submit="authVerify()" class="navbar-form pull-right" >
					<div ID="authIN">
            			<input ng-model="authLogin" type="text" class="span2" placeholder="логин" required>
            			<input ng-model="authPassword" type="password" class="span2" placeholder="пароль" required>
            			<button type="submit" class="btn" >Войти</button>
          			</div>
        		</form>  
              <!---/АУТЕНТИФИКАЦИЯ_ФОРМА ВХОДА--->
             
              <!---АУТЕНТИФИКАЦИЯ_ЗАЛОГИНИЛСЯ---> 
        		<form ng-submit="authLogout()" class="navbar-form pull-right" >
          		  <div ID="authOut" style="display:none;" class="navbar-for pull-right" >
           			<div class = "span3">
              			<p class="text-info" style="margin:0px">Добрый день, {{name}}</br>
             			<i class="icon-user"></i>&nbsp
             			<small><a href="" >Личный кабинет</a></small></p>
            		</div>
            		<div class = "span1">   
             			 <button type="submit" class="btn" >Выйти</button>
            	    </div>
          		  </div>  
         		</form> 
         	   <!---/АУТЕНТИФИКАЦИЯ_ЗАЛОГИНИЛСЯ--->  
         	 </div>
        <!---/АУТЕНТИФИКАЦИЯ--->  	 
        
        </nav>   
     </div>
<!---/НАВИГАЦИОННАЯ ПАНЕЛЬ---> 	
	
	
<!---ОТОБРАЖЕНИЕ ВАКАНСИИ---> 
		<div ID="vacancyShow" class="container" style="display:none;">
  				<form ng-submit="vacanciesConstruct()" style="margin-bottom:10px">
  					<button type="submit" class="btn" ><i class="icon-list"></i> Список вакансий</button>
  				</form>
  				<div class="well">
		 			<H3 class="text-info">{{txtVacancyName}}</h3>
		 			<h6 class="text">{{txtVacancyCompany}}</h6>
		 			<h7 class="text-info">{{txtVacancyCity}}</h7>
		 			<p>Зарплата от {{txtStartSalary}} до {{txtEndSalary}} </p>
		 			<p>{{txtMainInfo}}</p>
		 			<p>{{txtEduLevel}}</p>
		 			<p>{{txtAddInfo}}</p>
		 			<div>
       					<span class="label label-success">Размещено  {{txtRegDate}}</span><div class="pull-right"><span class="label">Актуально</span></div>
    				</div> 
		 		</div>
	     </div>
<!---/ОТОБРАЖЕНИЕ ВАКАНСИИ--->

<!---ВЫВОД ВАКАНСИЙ--->		
	   <div ID="vacanciesShow">
	<!---ФИЛЬТР--->	
			<div class="row ">
		  		<div class="input-append span5">
					<input type="text" size="100" id="appendedInput"  ng-model="filterVacancy" placeholder="Введите слово для поиска">
					<span class="add-on"><i class="icon-filter"></i></span>
		  		</div>	 
		  		<div class="span7"></div>			
			</div>
    <!---/ФИЛЬТР--->
    
			<div>
	     	  <nav class='navbar-inner reverse'>
	        	<ul class='nav nav-pills nav-stacked'>
	         		<li ng-repeat="vacancy in vacancies | filter:filterVacancy">
 	            
	            		<a  ng-click="showVacancy(vacancy.IDVac);" class='text-info' href=''>
	              			<i class="icon-hand-right"></i>&nbsp&nbsp
	              			<input type="hidden" ng-model="vacID" value="{{vacancy.IDVac}}" />
	              	
	              			<b>{{vacancy.VacancyName}}</b>
	            		</a>
		
	            		<small ><a href='' class="text-success">{{vacancy.CompanyName}}</a></small>
	            		<small>, <a href=''>{{vacancy.CityVacancy}}</a></small>
	            		<small class="text-error">, {{vacancy.StartSalary}} до {{vacancy.EndSalary}} руб.</small>
	           
	            		<font size='1px'>{{vacancy.RegDate}}</font>
	            		<hr style='margin-bottom:0px;'>
	          		</li>
	        	 </ul>
	       	   </nav>
	        </div>	
	      </div>       
<!---/ВЫВОД ВАКАНСИЙ--->	   
		
		
		<div id="footer">
			<div class=""></div>
			
		</div>
		
		
	</div>

    <script src="bootstrap/js/bootstrap.min.js"></script>
    <script src="http://code.jquery/jquery-latest.js"></script>
    
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.0.7/angular.min.js"></script>
</body>
</html>
]]></CSP>
</Export>
