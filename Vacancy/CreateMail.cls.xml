<?xml version="1.0" encoding="UTF-8"?>
<Export generator="Cache" version="25">
<Class name="Vacancy.CreateMail">
<Super>%SerialObject</Super>
<TimeCreated>63021,43547.622918</TimeCreated>

<Method name="NewMail">
<ClassMethod>1</ClassMethod>
<FormalSpec>Id:%String</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
 // 
 set vr=##class(Vacancy.VacancyResponse).%OpenId(Id)	
	
  #dim smtp As %Net.SMTP
  #dim mail As %Net.MailMessage
  
  set mail=##class(%Net.MailMessage).%New()
  // Отправитель
  set mail.From=""
  // Тема письма
  set mail.Subject="Отзыв на вакансию: "_vr.Vacancy.Name_" от: "_vr.FirstName
  // Кодировка
  set mail.Charset="utf-8"
  set mail.IsHTML=1
  set mail.ContentType="text/html"
  // Текст письма
  do mail.TextData.Write(vr.ResponseText)
  // Получатель
  do mail.To.Insert("")
  
  
  set smtp=##class(%Net.SMTP).%New()
  
  // Сервер исходящей почты, например smtp.mail.ru
  set smtp.smtpserver=""
  // Порт
  set smtp.port=25
  
  Set auth=##class(%Net.Authenticator).%New()
  // Имя пользователя, 123@mn.ru
  set auth.UserName=""
  // Пароль
  set auth.Password=""
  set smtp.authenticator=auth
  
  s status= smtp.Send(mail)

	Quit status
]]></Implementation>
</Method>

<Storage name="Default">
<Type>%Library.CacheSerialState</Type>
<StreamLocation>^Vacancy.CreateMailS</StreamLocation>
</Storage>
</Class>
</Export>
